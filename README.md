# Receipt Processor

This repository contains a simple webservice that processes receipts and provides an ability to calculate bonus points based on the receipt data.

## Overview

The Receipt Processor is a simple RESTful API service that accepts receipt data, returns a newly generated id and calculates bonus points.
As in-memory storage solution the program is using a Go map object. The data does not persist restarts as per reqiurements.

The `httprouter` package is used for fast and efficient routing.
The `alice` package is used for clear and readable middleware chaining.
The `uuid` package is used to generate new ids.

## Run the Program

- Make sure Go is installed locally.
- Clone or fork this repository.
- In the project folder, run the following command:

```sh
 go run ./cmd/web
```

## API Specification

### Endpoint: Process Receipts

- Path: `/receipts/process`
- Method: `POST`
- Payload: Receipt JSON
- Response: JSON containing an id for the receipt.

Description:

Takes in a JSON receipt and returns a JSON object with an ID generated by uuid package.

Example Response:

```json
{ "id": "7fb1377b-b223-49d9-a31a-5a02701dd310" }
```

### Endpoint: Get Points

- Path: `/receipts/{id}/points`
- Method: `GET`
- Response: A JSON object containing the number of points awarded.

A simple Getter endpoint that looks up the receipt by the ID and returns an object specifying the points awarded.

Example Response:

```json
{ "points": 32 }
```

## Application Architecture

Main package contains routes, middleware, handlers, helpers and utility functions.

- **Routes**:
  - Map incoming HTTP requests to their corresponding handler functions.
  -
- **Middleware**:

  - **logRequest**: Logs each incoming HTTP request with details such as IP, method, and URL;
  - **recoverPanic**: Catches any panics during request processing, closes the connection, and returns an internal server error response.

- **Handlers**:
  - **ProcessReceipt** decodes JSON payload, validates input, sends the input to ReceiptFactory, inserts new receipt into the Go map, and returns the newly created id;
  - **GetReceiptPoints** gets receipt id from the request, sends the id into the CalculatePoints function, and encodes the received points to send back to the user;
  - **ReceiptFactory** constructs a new receipt object and returns it.

Helpers include serverError and clientError helpers, JSON encoding and decoding helpers and a GetIdFromParams helper function.

Utility functions include all functions necessary to calculate bonus points.

Validation function ensures that all fields are non-empty, including items array containing at least one item.
